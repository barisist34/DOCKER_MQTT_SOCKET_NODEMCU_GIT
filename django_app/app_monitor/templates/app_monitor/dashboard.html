
{% extends "core/base.html" %}

{% load static %}

{% comment %} {% block style %}


{% endblock style %} {% endcomment %}

 {% comment %} td{
  text-align:center !important;
  vertical-align:middle !important;
  /* display: inline-block; */
  white-space: nowrap !important;
}

th{
  text-align:center;
  vertical-align:middle
} {% endcomment %}

{% comment %} {% static  "js/temperature_ajax.js" %} {% endcomment %}
{% block content %}

{% comment %} {% csrf_token %} {% endcomment %}
<script src="{% static 'js/temperature_ajax.js' %}"></script>
{% comment %} temperature_ajax.js scripti random olarak djangonun ürettiği değerleri 20 sn de dashboarddda basar. {% endcomment %}

<script>
const timer=() => {
  const time = new Date();
  const time_string= time.toLocaleTimeString();
  document.getElementById("saat").innerHTML=time_string;
}
  setInterval(timer,1000);

  </script>
<div class="container">


{% comment "ANASAYFA FILTRE" %}{% endcomment %}
<!--  filtre  -->
<!-- <form action="/app_monitor/device_filter_filter" > -->
  <div class="row offset-sm- mt-3">

    <div class="col">
      <form action="/app_monitor/filter_device_all" method="get"> <!--  id-sicaklıik tek buton form  -->
      <label class="col-sm-10" for="">ID</label><br>
      <input class="col-sm-10 mb-1" id="id-kucuk" name="id1" type="number" placeholder="İlk ID" pattern="[*-*-9-9]{4}" title="ID sayı olmalıdır">
      <input class="col-sm-10" id="id-buyuk" name="id2" type="number" placeholder="Son ID">
      <input hidden type="text" visibility:"hidden" display="none" name="cihaz_id" value="{{device_id}}"> <!-- cihazadi hidden  -->
    
    </div>
    <div class="col">
      {% comment %} <form action="/app_monitor/device_filter_sicaklik" method="get"> {% endcomment %}
      <label class="col-sm-10" for="">Sıcaklık</label><br>
      <input class="col-sm-10 mb-1" id="cihaz-sicaklik-kucuk" name="sicaklik1" type="number" step="0.1" placeholder="İlk Sıcaklık">
      <input class="col-sm-10" id="cihaz-sicaklik-buyuk" name="sicaklik2" type="number" step="0.1" placeholder="Son Sıcaklık">
      {% comment %} <input hidden type="text" visibility:"hidden" display="none" name="cihazadi" value="{{device_name}}"> <!-- cihazadi hidden  --> {% endcomment %}
      {% comment %} <button id="filtre-sicaklik" class="btn btn-danger btn-small col-sm-6 mt-1" type="submit" onsubmit="filtre_sicaklik()">SICAKLIK</button> {% endcomment %}
    {% comment %} </form> {% endcomment %}
  
    </div>
    <div class="col">
      {% comment %} <form action="/app_monitor/device_filter_nem" method="get"> {% endcomment %}
      <label class="col-sm-10" for="">Nem</label><br>
      <input class="col-sm-10 mb-1" id="cihaz-nem-kucuk" name="nem1" type="number" step="0.1" placeholder="İlk Nem">
      <input class="col-sm-10" id="cihaz-nem-buyuk" name="nem2" type="number" step="0.1" placeholder="Son Nem">
      {% comment %} <input hidden type="text" visibility:"hidden" display="none" name="cihazadi" value="{{device_name}}"> <!-- cihazadi hidden  --> {% endcomment %}
      {% comment %} <button id="filtre-nem" class="btn btn-danger btn-small col-sm-6 mt-1" type="submit" onsubmit="filtre_sicaklik()">NEM</button> {% endcomment %}
    {% comment %} </form> {% endcomment %}
  
    </div>
    <div class="col">
      {% comment %} <form action="/app_monitor/device_filter_voltaj" method="get"> {% endcomment %}
      <label class="col-sm-10 " for="">Voltaj</label><br>
      <input class="col-sm-10 mb-1" id="cihaz-voltaj-kucuk" name="voltaj1" step="0.1" type="number" placeholder="İlk Voltaj">
      <input class="col-sm-10" id="cihaz-voltaj-buyuk" name="voltaj2" type="number" step="0.1" placeholder="Son Voltaj">
      {% comment %} <input hidden type="text" visibility:"hidden" display="none" name="cihazadi" value="{{device_name}}"> <!-- cihazadi hidden  --> {% endcomment %}
      {% comment %} <button id="filtre-voltaj" class="btn btn-danger btn-small col-sm-6 mt-1" type="submit" >VOLTAJ</button> {% endcomment %}
    {% comment %} </form> {% endcomment %}
  </div>
  <div class="col">
    {% comment %} <form action="/app_monitor/device_filter_tarih" method="get"> {% endcomment %}
      <label class="col-sm-10 " for="">Tarih</label><br>
      <input class="col-sm-10 mb-1" id="tarih-kucuk" name="tarih1" type="datetime-local" placeholder="İlk Tarih">
      <input class="col-sm-10" id="tarih-buyuk" name="tarih2" type="datetime-local" placeholder="Son Tarih">
      {% comment %} <input hidden  type="text" visibility:"hidden" display="none" name="cihazadi" value="{{device_name}}"> <!-- cihazadi hidden  --> {% endcomment %}
      {% comment %} <button id="filtre-tarih" class="btn btn-danger btn-small col-sm-6 mt-1" type="submit" >TARIH</button> {% endcomment %}
      {% comment %} <button id="filtre-id" class="btn btn-danger btn-small col-sm-6 mt-3" type="submit" onsubmit="filtre_id()">ARA</button> {% endcomment %}
      <button id="filtre-id" class="btn btn-danger btn-small col-sm-6 mt-3" type="submit" >ARA</button>
      {% comment %} </form> {% endcomment %}
    </form><!--  id-sicaklık-nem-voltaj-tarih tek buton form  -->
    <a  href="/app_monitor/export_to_excel_all"> <button class="btn btn-success ms-3 mt-3">EXCEL</button> </a>
    </div>
    
  </div> <!--  row filtre  -->
  <div class="row">
    <div class="col-sm-6 offset-sm-3 mt-2">
    <!-- <input class="btn btn-danger" type="submit" value="Filtrele"> -->
  </div>
  </div> <!--  row submit  -->
  <!-- </form>  -->
  <!--  filtre son -->


  {% comment %} <h3 class="bg-primary text-center">TÜM CİHAZLAR</h3>  {% endcomment %}
  {% comment %} <h3 class="text-center">TÜM KAYITLAR</h3>  {% endcomment %}
  <div class="row">
    <div class="col-sm-4 d-flex align-items-end">
      <b id="saat"> </b>
    </div>
    <div class="col-sm-4 d-flex align-items-end mt-3">
      <h3 class="text-center">TÜM KAYITLAR</h3>
    </div>
  <div class="col-sm-4 d-flex justify-content-end mt-3">
    {% comment %} <a href="/app_monitor/export_to_excel_all"> <button class="btn btn-success">EXCEL</button> </a>  {% endcomment %}
   </div>
  </div>
        <div id="temperature_ajax">
            <b>Kayıt Sayısı: </b>{{kayit_sayisi_total_ajax}} <br>
               <table class="table table-hover">
              <thead>
                 <tr>
                  <th scope="col">id</th>
                  <th scope="col">Cihaz Adı</th>
                  <th scope="col">Cihaz ID</th>
                  <th scope="col">Sıcaklık</th>
                  <th scope="col">Nem</th>
                  <th scope="col">Voltaj</th>
                  <th scope="col">Tarih</th>
                  <th scope="col">Giriş-00</th>
                  <th scope="col">Giriş-01</th>
                  <th scope="col">Giriş-02</th>
                  <th scope="col">Giriş-03</th>
                  <th scope="col">Çıkış-0</th>
                  <th scope="col">Çıkış-00</th>
                  <th scope="col">Çıkış-01</th>
                  <th scope="col">Çıkış-02</th>
                  <th scope="col">Çıkış-03</th>
                  {% comment %} <th scope="col">Çıkış1</th>
                  <th scope="col">Çıkış2</th> {% endcomment %}
                  {% comment %} <th scope="col">Etiket</th> {% endcomment %}
                  <th scope="col">Açıklama</th>         
                 </tr>
               </thead>
             <tbody>
            
             {% comment %} {% for temp in tempsajax %} {% endcomment %}
             {% for temp in devicePaginator %}
             <tr>
                 {% if temp.temperature >= 45 %} <!--  if komutuyla sıcaklık 30 üstü olanlar kırmızı satır olacak --> 
               <th scope="row" style="background-color:#FF0000">{{temp.id}}</th>
               <td style="background-color:#FF0000">{{temp.temperature}}</td>
              <!--  <td> {{temp.date}}</td>  ilk hali saniyesiz --> 
                <td style="background-color:#FF0000"> {{temp.date|date:'Y-m-d H:i:s'}}</td> <!--  -->        
                     {% if temp.mailSend == False %}
                     <td style="background-color:#FF0000"> {{temp.mailSend}}</td>
                     {% else %}
                     <td style="background-color:#0000FF"> {{temp.mailSend}}</td>
                     {% endif %}
                 
                 {% else %}
          
               <th scope="row" >{{temp.id}}</th>
               {% comment %} <td> <a target="_blank" href="/app_monitor/cihazlar/{{temp.device_name}}/port={{temp.device_id.device_port}}" >{{temp.device_name}}</a> </td> {% endcomment %}
               <td> <a target="_blank" href="/app_monitor/cihazlar/cihaz_adi={{temp.device_name}}" >{{temp.device_name}}</a> </td>
               {% comment %} <td> <a target="_blank" href="/app_monitor/cihazlar/port={{temp.device_id.device_port}}/{{temp.device_id}}" >{{temp.device_id}}</a> </td> {% endcomment %}
               <td> <a target="_blank" href="/app_monitor/cihazlar/cihaz_id={{temp.device_id}}" >{{temp.device_id}}</a> </td>
               {% comment %} <td> {{temp.device_id}}</td> {% endcomment %}
               <td >{{temp.temperature}}</td>
               <td >{{temp.humidity}}</td>
               <td >{{temp.volcum}}</td>
               <!--  <td> {{temp.date}}</td>  ilk hali saniyesiz --> 
               <td > {{temp.date|date:'d-m-Y / H:i:s'}}</td> <!--  -->  
                {% if temp.input00 == "0" %} <td class="m-3" style="background-color:orange;margin:10px">{{temp.input00}}</td> {% else %} <td >{{temp.input00}}</td> {% endif %}
                {% comment %} <td >{{temp.input0}}</td> {% endcomment %}
                {% comment %} {% if temp.input01 == "0" %} <td class="m-3" style="background-color:orange;margin:10px">{{temp.input01}}</td> {% else %} <td >{{temp.input01}}</td> {% endif %} {% endcomment %}
                {% comment %} {% if temp.input01 == "0" %} <td class="text-center align-middle" style="background-color:orange;outline:15px solid white">{{temp.input01}}</td> {% else %} <td >{{temp.input01}}</td> {% endif %} {% endcomment %}
                {% if temp.input01 == "0" %} <td class="" style="text-align:center;vertical-align:middle;background-color:orange;">{{temp.input01}}</td> {% else %} <td >{{temp.input01}}</td> {% endif %}
                {% comment %} <td >{{temp.input1}}</td> {% endcomment %}
                <td style="">{{temp.input02}}</td>
                <td >{{temp.input03}}</td>
                <td >{{temp.cikis0}}</td>
                <td >{{temp.cikis00}}</td>
                <td >{{temp.cikis01}}</td>
                <td >{{temp.cikis02}}</td>
                <td >{{temp.cikis03}}</td>
               {% comment %} <td > {{temp.cikis1}}</td> <!--  -->  
               <td > {{temp.cikis2}}</td> <!--  -->   {% endcomment %}
               {% comment %} <td > {{temp.staff_name}}--{{temp.tag_id}} </td> <!--  -->                  {% endcomment %}
               <td style="display: flex;text-align:start;vertical-align:middle">
                {% comment %} <button type="button" data-bs-toggle="modal" data-bs-target="#modal1" data-bs-toggle="modal">...</button> {% endcomment %}
                <button type="button" data-bs-toggle="modal" data-bs-target="#modal{{temp.id}}" data-bs-toggle="modal">...</button>
                <span class="d-inline-block text-truncate" style="max-width: 150px;" >{{temp.additionalText}}</span>
                {% comment %} <div class="modal" id="modal1" data-bs-backdrop="static"> {% endcomment %}
                {% comment %} <div class="modal" id="modal{{temp.id}}" data-bs-backdrop="static" data-bs-keyboard="true"> {% endcomment %}
                <div class="modal" id="modal{{temp.id}}" data-bs-backdrop="static" tabindex="-1">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h4 class="modal-title">ID:{{temp.id}},Cihaz Adı:{{temp.device_name}}  </h4>
                        {% comment %} <button class="close">kapat</button> {% endcomment %}
                        <button type="button" class="close" data-bs-dismiss="modal">&times;</button> <!-- data-dismiss değil data-bs-dismiss OLMALI -->  
                      </div>
                      <form action="/app_monitor/additional_text">
                      <div class="modal-body">
                          <div class="mb-3">
                            <label for="acknowledge">Açıklama</label>
                            <textarea class="form-control" name="additional_text" id="additional_text" rows="5" >{{temp.additionalText}}</textarea>
                            {% comment %} <label id="modal_id" for="" name="{{modal_id}}" hidden>{{temp.id}} </label> {% endcomment %}
                            <input hidden type="text" name="temp_id" value="{{temp.id}} ">
                            <input hidden type="text" name="temp_user" value="{{request.user.username}} ">
                            <input hidden type="text" name="get_full_path" value="{{ request.get_full_path }}">
                          </div>
                        </div>
                        <div class="modal-footer">
                          {% comment %} <button  class="btn btn-secondary" data-bs-dismiss="modal">Sil</button> {% endcomment %}
                          <a class="btn btn-secondary" href="/app_monitor/additional_text_sil/{{temp.id}}" > Sil</a>
                          <button type="submit" class="btn btn-primary" data-bs-dismiss="modal" id="modal_kaydet">Kaydet </button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </td>
               <!-- Scrollable modal -->
          
               {% endif %}
             
             </tr>  
          
           {% endfor %}
             </tbody>
            </table>
            </div>

            <div class="row">
              <div class="col-sm-12 text-center mb-3">
               <!-- <br>
              <select name="" id="">
                {% for device in device_query %}
                <option value="{{device.device_name}}">
                <a href="/app_monitor/cihazlar/{{device.device_name}}">{{device.device_name}}</a> 
              </option>
                {% endfor %}
              </select> -->

              <a href="/app_monitor/cihazlar_tum" target="_blank">Tüm Cihazlar:</a> 
              
              <br>
              {% for device in device_query %}
              {% comment %} <a href="/app_monitor/cihazlar/{{device.device_name.capitalize}}" target="_blank">{{device.device_name}}</a> , {% endcomment %}
              {% comment %} <a href="/app_monitor/cihazlar/{{device.device_name.capitalize}}/port={{device.device_port}} " target="_blank">{{device.device_name}}</a> , {% endcomment %}
              {% comment %} <a href="/app_monitor/cihazlar/{{device.device_name.capitalize}}/devid={{device.pk}}/port={{device.device_port}} " target="_blank">{{device.device_name}}-{{device.device_id}} </a> , {% endcomment %}
              <a href="/app_monitor/cihazlar/{{device.device_name.capitalize}}/port={{device.device_port}}/devid={{device.pk}} " target="_blank">{{device.device_name}}-{{device.device_id}} </a> ,
              {% endfor %}
              <br>
              <!-- Cihazlar{{device_query}} -->             
              </div>
              </div>
        </div>
{% endblock content %}
